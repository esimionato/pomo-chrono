
(function($){$.pomochrono=function(el,options){var base=this;var ms=1,sec=ms*1000,min=sec*60,hr=min*60,day=hr*24;base.$el=$(el);base.el=el;base.$el.data("pomochrono",base);base.total_break_time=0;base.interrupts=[];base.total_interrupts=0;base.is_break=false;base.is_cancelled=false;base.is_started=false;var pad_for_two_digits=function(x){return x>9?x:"0"+x;};function number_with_commas(x){return x.toString().replace(/\B(?=(?:\d{3})+(?!\d))/g,",");};base.init=function(){base.options=$.extend({},$.pomochrono.defaultOptions,options);base.$el.html(pad_for_two_digits(base.options.pomodoro_duration)+":00");};base.start=function(f){if(base.is_break){base.is_break=false;base.end_time+=base.interrupts.pop();if(base.options.debug)console.log("end-time after interruption: "+base.end_time);}else{if(base.timer){base.cancel();};var date=new Date();base.end_time=date.getTime()+(base.options.pomodoro_duration*min);base.remaining_time=base.end_time-date.getTime();base.timer=setInterval(base.tick,sec);base.is_cancelled=false;base.is_started=true;base.interrupts=[];base.total_break_time=0;base.total_interrupts=0;base.show_remaining_time();base.show_break_time();if(f)f();}
if(base.options.run_at_start)base.options.run_at_start();if(base.options.debug)console.log(base.timer+" started.");};base.cancel=function(break_too_long){clearInterval(base.timer);if(base.options.debug)console.log(base.timer+" cancelled.");if(break_too_long){};base.is_cancelled=true;base.is_break=false;base.is_started=false;if(base.options.run_when_cancelled){base.options.run_when_cancelled();}};base.pause=function(paramaters,callback){var new_interrupt=sec;base.interrupts.push(new_interrupt);base.is_break=true;base.total_interrupts++;if(base.timer){if(base.options.run_when_paused){base.options.run_when_paused();}
if(base.options.debug)console.log(base.timer+" paused.");};};base.tick=function(){base.tock();};base.tock=function(){if(base.is_break){var current_interrupt=base.interrupts.pop()+sec;base.total_break_time++;base.interrupts.push(current_interrupt);if(base.total_break_time>base.options.break_duration){if(base.options.debug)console.log("Unacceptable :) too much break. Cancelling ... ");return base.cancel(true);}}else{var date=new Date();base.remaining_time=base.end_time-date.getTime();if(base.remaining_time<=0||base.total_break_time>=base.break_duration){base.cancel();base.options.run_at_end(base.total_break_time>=base.break_duration);}}
base.show_remaining_time();};base.show_remaining_time=function(){if(!base.is_break){var date=new Date();var minutes=Math.floor((base.remaining_time/min)%60);var seconds=Math.floor((base.remaining_time/sec)%60);base.$el.html(base.is_cancelled?"00:00":pad_for_two_digits(minutes)+":"+pad_for_two_digits(seconds));}else{base.show_break_time();};};base.show_break_time=function(){base.$el.fadeOut(200).fadeIn(300);if(base.options.display_break_time){base.options.display_break_time(pad_for_two_digits(base.total_break_time));};};base.init();};$.pomochrono.defaultOptions={activity_ref:null,pomodoro_duration:25,break_duration:15,run_at_start:null,run_at_end:null,run_when_cancelled:null,run_when_paused:null,display_working_time:null,display_break_time:null,debug:false};$.fn.pomochrono=function(options){return this.each(function(){(new $.pomochrono(this,options));});};$.fn.getPomoChrono=function(){this.data("pomochrono");};})(jQuery);